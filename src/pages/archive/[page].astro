---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import PostCard from "../../components/PostCard.astro";
import Pagination from "../../components/Pagination.astro";
import type { BlogType } from "../../content.config";
import Year from "../../components/Year.astro";

const blogs = await getCollection("blogs");
const years = [
  ...new Set(
    blogs.map((blog: BlogType) => new Date(blog.data.date).getFullYear()),
  ),
].sort((a, b) => b - a);

export async function getStaticPaths({
  paginate,
}: {
  paginate: (data: BlogType[], options: { pageSize: number }) => unknown;
}) {
  const blogs = await getCollection("blogs");
  blogs.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

  return paginate(blogs, { pageSize: 8 });
}

const { page } = Astro.props as { page: { data: BlogType[] } };
---

<BaseLayout
  title="Blogs"
  description="数字游民部落所有文章"
  author="数字游民Jarod"
  url="https://jarodise.com/archive/1"
>
  <meta name="robots" content="noindex,follow" slot="after-header" />
  <div class="center">
    <div
      class="flex flex-col items-start gap-4 md:flex-row md:items-center md:gap-8"
    >
      <a href="/archive/1" class="heading">Archive</a>
      <Year years={years} />
    </div>
    <ul class="my-3 space-y-3">
      {
        page.data.map((blog: BlogType) => (
          <li>
            <PostCard
              title={blog.data.title}
              date={blog.data.date
                .toLocaleDateString("en-GB", {
                  day: "numeric",
                  month: "short",
                })
                .slice(0, 11)}
              url={`/${blog.data.slug}`}
              tags={blog.data.tags}
            />
          </li>
        ))
      }
    </ul>
  </div>
  <Pagination page={page} />
</BaseLayout>
